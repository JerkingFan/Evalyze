# üêõ –û—Ç–ª–∞–¥–∫–∞ –æ—à–∏–±–∫–∏ "Error parsing JSON response"

## ‚úÖ –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:

### 1. –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `SupabaseUserRepository`:
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ DTO –æ—Ç Supabase
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ DTO ‚Üí User
- –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö —Å —Ç–∏–ø–∞–º–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

### 2. –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `UserRepository`:
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–∑–æ–≤–∞ `.block()`
- –û—Ç–ª–æ–≤ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

### 3. `@JsonIgnoreProperties(ignoreUnknown = true)` –≤ `SupabaseUserDto`:
- –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø–æ–ª–µ–π –∏–∑ Supabase
- –†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Å –ø–æ–ª—è–º–∏ –Ω–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü–µ (`–¢–µ–∫—Å—Ç –∏–∑–≤–µ—á–µ–Ω`, `–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑–≤–ª–µ—á–µ–Ω—ã`, –∏ —Ç.–¥.)

### 4. Fallback –¥–ª—è `status`:
- –ï—Å–ª–∏ status –ø—É—Å—Ç–æ–π –∏–ª–∏ null, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (EMPLOYEE)

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

### 1. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∏ –æ–±–Ω–æ–≤–∏—Ç–µ:
```bash
# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å
./gradlew clean build -x test

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
scp build/libs/NEW_NEW_MVP-0.0.1-SNAPSHOT.jar root@5.83.140.54:~/start.jar

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
ssh root@5.83.140.54 "pkill -f start.jar && nohup java -jar start.jar > app.log 2>&1 &"
```

### 2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
ssh root@5.83.140.54 "tail -100 app.log"
```

## üìä –ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö:

### –ü—Ä–∏ —É—Å–ø–µ—Ö–µ:
```
=== SUPABASE INSERT DEBUG ===
Inserting user into Supabase: {email=..., full_name=..., activation_code=..., status=...}
Request body (as array): [{...}]

Received SupabaseUserDto: id=147, email=233235@gmail.com

=== convertDtoToUser START ===
DTO: id=147, email=233235@gmail.com, status={"role":"EMPLOYEE"}
Parsing status JSON: {"role":"EMPLOYEE"}
Extracted role: EMPLOYEE
Converted ID: 147 -> a1b2c3d4-...
=== convertDtoToUser END ===

=== SUCCESS ===
User saved successfully: 233235@gmail.com
User ID: a1b2c3d4-...
User Role: EMPLOYEE
===============

UserRepository.save() - SUCCESS: 233235@gmail.com
```

### –ü—Ä–∏ –æ—à–∏–±–∫–µ:
```
=== ERROR ===
Error type: com.fasterxml.jackson.databind.JsonMappingException
Error message: Cannot deserialize...
Full stack trace:
...
=============

UserRepository.save() - ERROR: ...
```

## üîç –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

### 1. –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–∞—Ä—Å–∏–Ω–≥–æ–º JSON:
- **–ü—Ä–∏—á–∏–Ω–∞:** Jackson –Ω–µ –º–æ–∂–µ—Ç —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç Supabase
- **–†–µ—à–µ–Ω–∏–µ:** `@JsonIgnoreProperties(ignoreUnknown = true)` –¥–æ–ª–∂–Ω–æ –ø–æ–º–æ—á—å

### 2. –ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç Supabase:
- **–ü—Ä–∏—á–∏–Ω–∞:** Supabase –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ `[]`
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏, –≤–æ–∑–º–æ–∂–Ω–æ INSERT –ø—Ä–æ—à–µ–ª, –Ω–æ SELECT –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω

### 3. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö:
- **–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ª—è —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π –∏–ª–∏ jsonb –ø–æ–ª—è–º–∏
- **–†–µ—à–µ–Ω–∏–µ:** –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Å `@JsonIgnoreProperties`

## üéØ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

–ï—Å–ª–∏ –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Å–ø–µ—Ö, –Ω–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É, –ø—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤:
1. JWT —Ç–æ–∫–µ–Ω–µ (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ç–æ–∫–µ–Ω–∞)
2. –§–æ—Ä–º–∞—Ç–µ –æ—Ç–≤–µ—Ç–∞ `AuthResponse`
3. CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

–ü—Ä–∏—à–ª–∏—Ç–µ –ø–æ–ª–Ω—ã–µ –ª–æ–≥–∏, –µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è!

