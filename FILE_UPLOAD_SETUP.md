# Настройка загрузки файлов

## Описание
Реализована система загрузки множественных файлов с сохранением состояния при перезагрузке страницы. Пользователи могут загружать файлы, добавлять описания и теги, а также управлять загруженными файлами.

## Что реализовано

### Backend
1. **Модель FileUpload** - хранение информации о файлах:
   - originalFileName, storedFileName, filePath
   - fileSize, mimeType, uploadedAt
   - description, tags
   - Связь с пользователем

2. **FileUploadService** - бизнес-логика:
   - Загрузка множественных файлов
   - Проверка размера и типа файлов
   - Генерация уникальных имен
   - Организация по папкам пользователей

3. **FileUploadController** - REST API:
   - `POST /api/files/upload` - загрузка файлов
   - `GET /api/files` - получение списка файлов
   - `GET /api/files/{id}` - получение информации о файле
   - `DELETE /api/files/{id}` - удаление файла
   - `GET /api/files/download/{id}` - скачивание файла
   - `GET /api/files/search` - поиск файлов
   - `GET /api/files/type/{mimeType}` - фильтрация по типу

### Frontend
1. **Интерфейс загрузки** - множественный выбор файлов:
   - Drag & drop поддержка
   - Превью выбранных файлов
   - Поля для описания и тегов
   - Валидация типов файлов

2. **Управление файлами** - список загруженных файлов:
   - Отображение информации о файлах
   - Скачивание и удаление
   - Поиск и фильтрация
   - Автообновление списка

3. **Сохранение состояния** - localStorage:
   - Сохранение списка файлов
   - Восстановление при перезагрузке
   - Синхронизация с сервером

## Настройка

### 1. Конфигурация загрузки
```properties
# В application.properties
app.upload.path=${UPLOAD_PATH:./uploads}
app.upload.max-size=10485760
app.upload.allowed-types=image/*,application/pdf,text/*,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document
```

### 2. Переменные окружения
```bash
export UPLOAD_PATH=/path/to/uploads
```

### 3. Создание директории
```bash
mkdir -p ./uploads
chmod 755 ./uploads
```

## Поддерживаемые типы файлов

- **Изображения**: jpg, jpeg, png, gif, bmp, webp
- **Документы**: pdf, txt, doc, docx
- **Размер**: до 10MB на файл
- **Количество**: неограниченно

## Безопасность

1. **Проверка типов файлов** - только разрешенные MIME типы
2. **Ограничение размера** - максимум 10MB на файл
3. **Изоляция пользователей** - файлы хранятся в отдельных папках
4. **Уникальные имена** - предотвращение конфликтов
5. **Авторизация** - доступ только к своим файлам

## Структура хранения

```
uploads/
├── user-uuid-1/
│   ├── 20241201_143022_abc12345.pdf
│   ├── 20241201_143023_def67890.jpg
│   └── ...
├── user-uuid-2/
│   └── ...
└── ...
```

## API Endpoints

### Загрузка файлов
```
POST /api/files/upload
Content-Type: multipart/form-data
Authorization: Bearer <token>

files: [file1, file2, ...]
description: "Описание файлов"
tags: "тег1, тег2, тег3"
```

### Получение списка файлов
```
GET /api/files
Authorization: Bearer <token>
```

### Скачивание файла
```
GET /api/files/download/{fileId}
Authorization: Bearer <token>
```

### Удаление файла
```
DELETE /api/files/{fileId}
Authorization: Bearer <token>
```

### Поиск файлов
```
GET /api/files/search?query=резюме
Authorization: Bearer <token>
```

## Функции фронтенда

### Загрузка файлов
1. Выбор файлов (множественный)
2. Drag & drop поддержка
3. Превью выбранных файлов
4. Добавление описания и тегов
5. Валидация перед загрузкой

### Управление файлами
1. Список всех загруженных файлов
2. Информация о каждом файле
3. Скачивание файлов
4. Удаление файлов
5. Поиск по названию
6. Фильтрация по типу

### Сохранение состояния
1. Автоматическое сохранение в localStorage
2. Восстановление при перезагрузке
3. Синхронизация с сервером
4. Обработка ошибок сети

## Использование

### Для пользователей
1. Войдите в систему через email авторизацию
2. Перейдите на страницу профиля
3. В разделе "Загрузка файлов" выберите файлы
4. Добавьте описание и теги (необязательно)
5. Нажмите "Загрузить файлы"
6. Управляйте файлами в разделе "Загруженные файлы"

### Для разработчиков
```javascript
// Инициализация менеджера файлов
const fileManager = new FileUploadManager();

// Загрузка файлов
await fileManager.uploadFiles();

// Получение списка файлов
await fileManager.loadUserFiles();

// Скачивание файла
await fileManager.downloadFile(fileId);

// Удаление файла
await fileManager.deleteFile(fileId);
```

## Troubleshooting

### Файлы не загружаются
- Проверьте размер файлов (максимум 10MB)
- Убедитесь, что тип файла поддерживается
- Проверьте права доступа к папке uploads
- Проверьте логи приложения

### Файлы не отображаются
- Проверьте авторизацию пользователя
- Убедитесь, что токен действителен
- Проверьте подключение к базе данных
- Очистите localStorage и попробуйте снова

### Ошибки скачивания
- Проверьте, что файл существует на диске
- Убедитесь, что у пользователя есть права на файл
- Проверьте логи сервера

## Мониторинг

### Логи
- Загрузка файлов: `INFO` уровень
- Ошибки загрузки: `ERROR` уровень
- Удаление файлов: `INFO` уровень

### Метрики
- Количество загруженных файлов
- Общий размер файлов
- Популярные типы файлов
- Активность пользователей
