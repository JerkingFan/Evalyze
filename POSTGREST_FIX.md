# PostgREST (Supabase) - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ 400

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### üîß –ü—Ä–æ–±–ª–µ–º–∞ #1: PostgREST –æ–∂–∏–¥–∞–µ—Ç –º–∞—Å—Å–∏–≤

**–ë—ã–ª–æ:**
```json
{ "email": "test@example.com", "role": "EMPLOYEE" }
```

**–°—Ç–∞–ª–æ:**
```json
[{ "email": "test@example.com", "role": "EMPLOYEE" }]
```

PostgREST **–≤—Å–µ–≥–¥–∞ –æ–∂–∏–¥–∞–µ—Ç –º–∞—Å—Å–∏–≤** –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π INSERT, –¥–∞–∂–µ –µ—Å–ª–∏ –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç.

### üîß –ü—Ä–æ–±–ª–µ–º–∞ #2: –ó–∞–≥–æ–ª–æ–≤–æ–∫ Prefer

**–ë—ã–ª–æ:**
```
Prefer: return=minimal
```

**–°—Ç–∞–ª–æ:**
```
Prefer: return=representation
```

–¢–µ–ø–µ—Ä—å PostgREST –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è (ID, created_at –∏ —Ç.–¥.)

### üîß –ü—Ä–æ–±–ª–µ–º–∞ #3: –ò–º–µ–Ω–∞ –ø–æ–ª–µ–π (snake_case)

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –ø–æ–ª–µ–π –¥–ª—è Supabase:**
```json
{
  "id": "uuid",
  "email": "test@example.com",
  "full_name": "–ò–º—è –§–∞–º–∏–ª–∏—è",       // –ù–ï fullName
  "role": "EMPLOYEE",
  "company_id": "uuid",              // –ù–ï companyId
  "google_oauth_token": "token"     // –ù–ï googleOauthToken
}
```

## üìù –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. SupabaseConfig.java
- –£–±—Ä–∞–Ω –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Prefer: return=minimal`
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å —Å–≤–æ–π Prefer –∑–∞–≥–æ–ª–æ–≤–æ–∫

### 2. SupabaseUserRepository.java
- `save()` –º–µ—Ç–æ–¥ —Ç–µ–ø–µ—Ä—å:
  - ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ **–º–∞—Å—Å–∏–≤**
  - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **snake_case** –¥–ª—è –∏–º–µ–Ω –ø–æ–ª–µ–π
  - ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ `company_id`, –∞ –Ω–µ –≤–µ—Å—å –æ–±—ä–µ–∫—Ç Company
  - ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Prefer: return=representation`
  - ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç –∫–∞–∫ –º–∞—Å—Å–∏–≤ –∏ –±–µ—Ä–µ—Ç –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç

### 3. SupabaseService.java
- `insert()` –º–µ—Ç–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–∞—Å—Å–∏–≤–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –æ–±—ä–µ–∫—Ç –≤ –º–∞—Å—Å–∏–≤
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –∏–∑ –º–∞—Å—Å–∏–≤–∞ –≤ –æ—Ç–≤–µ—Ç–µ

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
```bash
pkill -f start.jar
nohup java -jar start.jar > app.log 2>&1 &
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é:
```bash
curl -X POST http://5.83.140.54:8089/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "123456",
    "fullName": "–≠–¥–≤–∞—Ä–¥ –≠–¥–≤–≤–∞—Ä–¥–æ–≤",
    "role": "EMPLOYEE"
  }'
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
tail -f app.log | grep -E "(Inserting|Supabase response|saved successfully)"
```

## üîç –û—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –ø–æ–ª—É—á–∞–µ—Ç–µ 400:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏** –≤ Supabase Dashboard
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ö–µ–º—É —Ç–∞–±–ª–∏—Ü—ã** `users` - –∫–∞–∫–∏–µ –ø–æ–ª—è NOT NULL
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Supabase** (Dashboard ‚Üí Logs)
4. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å SERVICE_ROLE_KEY** (—Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ!)

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã users

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `users` –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```sql
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email TEXT UNIQUE NOT NULL,
  full_name TEXT,
  role TEXT NOT NULL,
  company_id UUID REFERENCES companies(id),
  google_oauth_token TEXT,
  created_at TIMESTAMPTZ DEFAULT now()
);
```

## ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å:
```json
{
  "token": "eyJhbGci...",
  "email": "test@example.com",
  "role": "EMPLOYEE",
  "fullName": "–≠–¥–≤–∞—Ä–¥ –≠–¥–≤–≤–∞—Ä–¥–æ–≤",
  "companyName": null,
  "message": "Registration successful"
}
```

## üéØ –í–∞–∂–Ω–æ

1. PostgREST **–í–°–ï–ì–î–ê** –æ–∂–∏–¥–∞–µ—Ç –º–∞—Å—Å–∏–≤ –¥–ª—è INSERT
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **snake_case** –¥–ª—è –∏–º–µ–Ω –ø–æ–ª–µ–π
3. –î–æ–±–∞–≤–ª—è–π—Ç–µ `Prefer: return=representation` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ - –æ–Ω–∏ –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å INSERT

