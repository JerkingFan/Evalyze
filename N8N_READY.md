# โ n8n Google OAuth - ะะพัะพะฒะพ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั!

## ๐ ะกัะฐััั: n8n workflow ะฐะบัะธะฒะธัะพะฒะฐะฝ!

ะะพะปััะตะฝ ะพัะฒะตั ะพั n8n: `{"message":"Workflow was started"}`

---

## โ ะงัะพ ะฑัะปะพ ัะดะตะปะฐะฝะพ:

### 1. Backend ะธะทะผะตะฝะตะฝะธั
- โ **GoogleOAuthService.java** - ะฟะตัะตะบะปััะตะฝ ะฝะฐ ัะตะฐะปัะฝัะน n8n webhook
- โ **MockN8nController.java** - ัะดะฐะปัะฝ (ะฑะพะปััะต ะฝะต ะฝัะถะตะฝ)

### 2. Frontend ะธะทะผะตะฝะตะฝะธั
- โ **Bootstrap ะทะฐะณััะถะฐะตััั ะปะพะบะฐะปัะฝะพ** - ะฝะต ะทะฐะฒะธัะธั ะพั CDN
- โ **app.js** - ะณะพัะพะฒ ะบ ัะฐะฑะพัะต ั n8n

### 3. n8n workflow
- โ **ะะบัะธะฒะธัะพะฒะฐะฝ ะธ ัะฐะฑะพัะฐะตั**
- โ **URL:** `https://guglovskij.app.n8n.cloud/webhook/07a96af0-9f1f-44e7-bad3-86a2c4e0cb28`

---

## ๐ ะะตะฟะปะพะน ัะธะฝะฐะปัะฝะพะน ะฒะตััะธะธ:

### ะะฐ ะปะพะบะฐะปัะฝะพะน ะผะฐัะธะฝะต (Windows):

```bash
# 1. ะะตัะตัะพะฑะตัะธ ะฟัะพะตะบั
./gradlew clean build -x test

# 2. ะะฐะนะดะธ jar ัะฐะนะป
ls build/libs/
# ะะพะปะถะตะฝ ะฑััั: NEW_NEW_MVP-0.0.1-SNAPSHOT.jar
```

### ะะฐ ัะตัะฒะตัะต (Linux):

```bash
# 1. ะััะฐะฝะพะฒะธ ััะฐัะพะต ะฟัะธะปะพะถะตะฝะธะต
pkill -f start.jar

# 2. ะะฐะณััะทะธ ะฝะพะฒัะน jar (ะธะปะธ ัะพะฑะตัะธ ะฝะฐ ัะตัะฒะตัะต)
# ะงะตัะตะท FileZilla, scp ะธะปะธ:
# cd /path/to/project && ./gradlew clean build -x test
# cp build/libs/*.jar /root/start.jar

# 3. ะะฐะฟัััะธ ะฟัะธะปะพะถะตะฝะธะต
cd /root
nohup java -jar start.jar > app.log 2>&1 &

# 4. ะัะพะฒะตัั ััะพ ะทะฐะฟัััะธะปะพัั
tail -f app.log
# ะะดะธ: "Started NewNewMvpApplication" ะธ "Tomcat started on port 8089"

# 5. ะัะพะฒะตัั ะดะพัััะฟะฝะพััั
curl http://localhost:8089
```

---

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต:

### 1. ะัะพะฒะตัั n8n webhook:
```bash
curl -I https://guglovskij.app.n8n.cloud/webhook/07a96af0-9f1f-44e7-bad3-86a2c4e0cb28
# ะะพะปะถะฝะพ ะฒะตัะฝััั 302 (ัะตะดะธัะตะบั ะฝะฐ Google)
```

### 2. ะัะพะฒะตัั backend:
```bash
curl http://5.83.140.54:8089/api/auth/google/url
# ะะพะปะถะฝะพ ะฒะตัะฝััั: https://guglovskij.app.n8n.cloud/webhook/...
```

### 3. ะัะพะฒะตัั ัะตัะตะท ะฑัะฐัะทะตั:

#### a) ะัะบัะพะน ัะฐะนั:
```
http://5.83.140.54:8089
```

#### b) ะะฐะถะผะธ "ะะพะนัะธ ัะตัะตะท Google"

#### c) ะะพะปะถะตะฝ ะฟัะพะธะทะพะนัะธ ัะตะดะธัะตะบั:
```
ะกะฐะนั โ n8n webhook โ Google OAuth โ Backend callback โ ะกะฐะนั ั ัะพะบะตะฝะพะผ
```

#### d) ะะพัะปะต ััะฟะตัะฝะพะน ะฐะฒัะพัะธะทะฐัะธะธ:
- ะ localStorage ะดะพะปะถะตะฝ ะฟะพัะฒะธัััั JWT ัะพะบะตะฝ
- ะะพะปะถะตะฝ ะฑััั ัะตะดะธัะตะบั ะฝะฐ `/profile` ะธะปะธ `/company`
- ะ ะฝะฐะฒะธะณะฐัะธะธ ะดะพะปะถะฝะพ ะพัะพะฑัะฐะถะฐัััั ะธะผั ะฟะพะปัะทะพะฒะฐัะตะปั

---

## ๐ ะัะปะฐะดะบะฐ (ะตัะปะธ ััะพ-ัะพ ะฝะต ัะฐะฑะพัะฐะตั):

### ะะพะณะธ backend:
```bash
tail -f app.log
# ะัะธ:
# "Redirecting to n8n webhook for Google OAuth"
# "=== Google OAuth via n8n START ==="
```

### ะะพะณะธ n8n:
1. ะัะบัะพะน workflow ะฒ n8n
2. ะะตัะตะนะดะธ ะฒ **Executions** (ัะฟัะฐะฒะฐ)
3. ะกะผะพััะธ ะธััะพัะธั ะฒัะฟะพะปะฝะตะฝะธะน

### ะะพะฝัะพะปั ะฑัะฐัะทะตัะฐ (F12):
```javascript
// ะัะพะฒะตัั ััะพ Bootstrap ะทะฐะณััะถะตะฝ
typeof bootstrap // ะะพะปะถะฝะพ ะฑััั "object"

// ะัะพะฒะตัั ัะพะบะตะฝ ะฟะพัะปะต ะฐะฒัะพัะธะทะฐัะธะธ
localStorage.getItem('token')
localStorage.getItem('user')
```

### ะัะพะฒะตัะบะฐ ัะตะดะธัะตะบัะพะฒ (F12 โ Network):
1. ะคะธะปััั: All
2. Preserve log: โ
3. ะะฐะถะผะธ "ะะพะนัะธ ัะตัะตะท Google"
4. ะกะปะตะดะธ ะทะฐ ัะตะดะธัะตะบัะฐะผะธ:
   - `/api/auth/google/url` โ 200 OK
   - ะะตะดะธัะตะบั ะฝะฐ n8n webhook
   - ะะตะดะธัะตะบั ะฝะฐ Google
   - Callback ะฝะฐ backend
   - ะคะธะฝะฐะปัะฝัะน ัะตะดะธัะตะบั ะฝะฐ `/`

---

## ๐ ะััะธัะตะบัััะฐ (ัะธะฝะฐะปัะฝะฐั):

```
โโโโโโโโโโโโโโโ
โ   Browser   โ
โโโโโโโโฌโโโโโโโ
       โ 1. Click "Login with Google"
       โผ
โโโโโโโโโโโโโโโ
โ   Backend   โ /api/auth/google/url
โ  (Spring)   โ โ Returns n8n webhook URL
โโโโโโโโฌโโโโโโโ
       โ 2. Redirect to n8n
       โผ
โโโโโโโโโโโโโโโ
โ n8n Webhook โ https://guglovskij.app.n8n.cloud/webhook/...
โ  (n8n.io)   โ โ Redirects to Google OAuth
โโโโโโโโฌโโโโโโโ
       โ 3. Redirect to Google
       โผ
โโโโโโโโโโโโโโโ
โ   Google    โ accounts.google.com/o/oauth2/v2/auth
โ    OAuth    โ โ User authorizes
โโโโโโโโฌโโโโโโโ
       โ 4. Callback with code
       โผ
โโโโโโโโโโโโโโโ
โ   Backend   โ /api/auth/google/callback?code=...
โ  (Spring)   โ โ n8n validates & returns user info
โโโโโโโโฌโโโโโโโ โ Creates/finds user
       โ         โ Generates JWT
       โ 5. Redirect with token
       โผ
โโโโโโโโโโโโโโโ
โ   Browser   โ /?token=...&email=...&role=...
โ (Logged in) โ โ Saves to localStorage
โโโโโโโโโโโโโโโ โ Redirects to /profile or /company
```

---

## ๐ฆ ะะทะผะตะฝัะฝะฝัะต ัะฐะนะปั (ัะธะฝะฐะปัะฝัะต):

```
Backend:
โ GoogleOAuthService.java - ะธัะฟะพะปัะทัะตั n8n webhook
โ GoogleOAuthController.java - ะพะฑัะฐะฑะฐััะฒะฐะตั n8n callback
โ MockN8nController.java - ัะดะฐะปัะฝ

Frontend:
โ index.html - Bootstrap ะปะพะบะฐะปัะฝะพ
โ app.js - ะผะตัะพะดั ะฐะฒัะพัะธะทะฐัะธะธ ะพะฑะฝะพะฒะปะตะฝั

Static assets:
โ bootstrap.bundle.min.js - ะปะพะบะฐะปัะฝะฐั ะบะพะฟะธั
โ bootstrap.min.css - ะปะพะบะฐะปัะฝะฐั ะบะพะฟะธั

Config:
โ application.properties - OAuth ะฝะฐัััะพะนะบะธ ะทะฐะบะพะผะผะตะฝัะธัะพะฒะฐะฝั
โ build.gradle - oauth2-client ะทะฐะบะพะผะผะตะฝัะธัะพะฒะฐะฝ

Docs:
โ GOOGLE_OAUTH_N8N.md - ะฟะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั
โ N8N_WEBHOOK_SETUP.md - ะฝะฐัััะพะนะบะฐ n8n
โ START_HERE.md - ะฑัััััะน ััะฐัั
โ N8N_READY.md - ััะพั ัะฐะนะป
```

---

## โ Checklist ะฟะตัะตะด ัะตะปะธะทะพะผ:

- [x] Backend ัะพะฑัะฐะฝ ะฑะตะท ะพัะธะฑะพะบ
- [x] n8n workflow ัะพะทะดะฐะฝ ะธ ะฐะบัะธะฒะธัะพะฒะฐะฝ
- [x] Bootstrap ะทะฐะณััะถะฐะตััั ะปะพะบะฐะปัะฝะพ
- [x] Mock ะบะพะฝััะพะปะปะตั ัะดะฐะปัะฝ
- [ ] ะัะธะปะพะถะตะฝะธะต ะทะฐะดะตะฟะปะพะตะฝะพ ะฝะฐ ัะตัะฒะตั
- [ ] ะขะตัั ะฐะฒัะพัะธะทะฐัะธะธ ะฟัะพััะป ััะฟะตัะฝะพ
- [ ] ะะพะณะธ ะฟัะพะฒะตัะตะฝั (ะฝะตั ะพัะธะฑะพะบ)
- [ ] ะัะฐัะทะตั ัะตัั (ะผะพะดะฐะปั ะพัะบััะฒะฐัััั)
- [ ] E2E ัะตัั (ะฟะพะปะฝัะน flow ะฐะฒัะพัะธะทะฐัะธะธ)

---

## ๐ ะัั ะณะพัะพะฒะพ!

ะะพัะปะต ะดะตะฟะปะพั ะฐะฒัะพัะธะทะฐัะธั ัะตัะตะท Google ะฑัะดะตั ัะฐะฑะพัะฐัั ัะตัะตะท n8n webhook!

**ะกะปะตะดัััะธะน ัะฐะณ:** ะะตัะตัะพะฑะตัะธ, ะทะฐะดะตะฟะปะพะน ะธ ะฟัะพัะตััะธััะน! ๐

---

## ๐ Troubleshooting:

### ะัะพะฑะปะตะผะฐ: 404 ะพั n8n
**ะะตัะตะฝะธะต:** ะัะพะฒะตัั ััะพ workflow ะฐะบัะธะฒะตะฝ (ะทะตะปัะฝัะน toggle)

### ะัะพะฑะปะตะผะฐ: Bootstrap ะพัะธะฑะบะธ
**ะะตัะตะฝะธะต:** Ctrl+Shift+R ะดะปั ะถัััะบะพะน ะฟะตัะตะทะฐะณััะทะบะธ

### ะัะพะฑะปะตะผะฐ: "OAuth via n8n failed"
**ะะตัะตะฝะธะต:** ะัะพะฒะตัั ะปะพะณะธ backend ะธ n8n executions

### ะัะพะฑะปะตะผะฐ: Connection refused
**ะะตัะตะฝะธะต:** ะัะพะฒะตัั ััะพ Spring Boot ะทะฐะฟััะตะฝ ะฝะฐ ะฟะพััั 8089

---

**ะฃะดะฐัะธ! ะัั ะดะพะปะถะฝะพ ัะฐะฑะพัะฐัั! ๐**

